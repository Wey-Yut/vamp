from random import randint


class VamRoll :

    def __init__(self, dice_pool, hunger, difficulty) :

        self.dice_pool = dice_pool
        self.hunger = hunger
        self.difficulty = difficulty

        if hunger > dice_pool :
            self.hunger_dice = dice_pool
        else :
            self.hunger_dice = hunger

        self.normal_dice = dice_pool - self.hunger_dice

        self.chance_bestial_fail = None
        self.chance_fail = None
        self.chance_normal_success = None
        self.chance_bestial_crit = None
        self.chance_normal_crit = None

        self.rolled = None

    def __roll_met(self) :
        successes = 0
        fail = 0
        crit_normal = 0
        crit_hunger = 0
        rolled_dices_normal = []
        rolled_dices_hunger = []
        
        # normal dice trow
        for d in range(self.normal_dice) :
            rolled = randint(1, 10)
            rolled_dices_normal += [rolled]
            if rolled == 10 :
                successes += 1
                crit_normal += 1
            elif rolled >= 6 :
                successes += 1
                
        # hunger dice trow
        for d in range(self.hunger_dice) :
            rolled = randint(1, 10)
            rolled_dices_hunger += [rolled]
            if rolled == 10 :
                successes += 1
                crit_hunger += 1
            elif rolled >= 6 :
                successes = successes + 1
            elif rolled == 1 :
                fail = 1

        successes_crit = ((crit_hunger + crit_normal) // 2) * 2
        successes += successes_crit

        roll_info = {'successes' : successes,
                     'successes_crit' : successes_crit,
                     'fail' : fail,
                     'crit_normal' : crit_normal,
                     'crit_hunger' : crit_hunger,
                     'rolled_dices_normal' : rolled_dices_normal,
                     'rolled_dices_hunger' : rolled_dices_hunger,
                     'status' : 0}
                     
        # Determining roll outcome
        if successes >= self.difficulty :
            if successes_crit > 0 :
                if crit_hunger != 0 :
                    roll_info['status'] = 'bestial_crit_roll'
                else :
                    roll_info['status'] = 'normal_crit_roll'
            else :
                roll_info['status'] = 'success_roll'
        else :
            if fail != 0 :
                roll_info['status'] = 'bestial_fail_roll'
            else :
                roll_info['status'] = 'fail_roll'

        return roll_info

    def roll(self) :
        self.rolled = VamRoll.__roll_met(self)

    def probability(self, reps=10000) :
        rolls = {'normal_crit_roll' : 0,
                 'bestial_crit_roll' : 0,
                 'success_roll' : 0,
                 'bestial_fail_roll' : 0,
                 'fail_roll' : 0}
                 
        # rolling for a lot of times to gather data
        for r in range(reps) :
            roll = VamRoll.__roll_met(self)
            roll_status = roll['status']
            rolls[roll_status] += 1

        self.chance_normal_crit = rolls['normal_crit_roll'] * 100 / reps
        self.chance_bestial_crit = rolls['bestial_crit_roll'] * 100 / reps
        self.chance_normal_success = rolls['success_roll'] * 100 / reps
        self.chance_fail = rolls['fail_roll'] * 100 / reps
        self.chance_bestial_fail = rolls['bestial_fail_roll'] * 100 / reps

    def print_roll(self) :
        if self.rolled is None :
            VamRoll.roll(self)

        print("Dice pool:", self.dice_pool)
        print('Hunger:', self.hunger)
        print('Difficulty:', self.difficulty)
        print('Normal dice rolled:', self.rolled['rolled_dices_normal'])
        print('hunger dice rolled: ', self.rolled['rolled_dices_hunger'])
        print('Successes:', self.rolled['successes'])

        if self.rolled['status'] == 'normal_crit_roll' :
            print('CRITICAL SUCCESS')

        elif self.rolled['status'] == 'bestial_crit_roll' :
            print('BESTIAL SUCCESS')

        elif self.rolled['status'] == 'succes_roll' :
            print('Success')

        elif self.rolled['status'] == 'bestial_fail_roll' :
            print('BESTIAL FAILURE')

        elif self.rolled['status'] == 'fail_roll' :
            print('Fail')

    def print_probability(self) :
        if self.chance_fail is None :
            VamRoll.probability(self)

        print('Crit chance: % 2.2f %%' % self.chance_normal_crit)
        print('Bestial crit chance: % 2.2f %%' % self.chance_bestial_crit)
        print('Normal success chance: % 2.2f %%' % self.chance_normal_success)
        print('Total chance for success: % 2.2f %%' % (self.chance_normal_crit +
                                                       self.chance_bestial_crit +
                                                       self.chance_normal_success))
        print('')
        print('Normal fail chance: % 2.2f %%' % self.chance_fail)
        print('Bestial failure chance: % 2.2f %%' % self.chance_bestial_fail)
        print('Total chance for failure: % 2.2f %%' % (self.chance_fail +
                                                       self.chance_bestial_fail))


if __name__ == '__main__' :
    control = 'y'
    while control == 'y' or control == 'Y' :
        dices = int(input('Dice pool?\n'))
        hunger_level = int(input('Hunger?\n'))
        difficulty_level = int(input('Difficulty?\n'))

        if dices < 1 :
            dices = 1

        test_vampire = VamRoll(dices, hunger_level, difficulty_level)
        test_vampire.print_roll()
        print('')
        test_vampire.print_probability()

        control = input('Next roll?(Y/N)\n')
